<!doctype html><html data-theme=auto lang=en xmlns=http://www.w3.org/1999/xhtml><head><meta charset=UTF-8><meta content="Writing down my learning process. Probably mainly Rust, and Java..." name=description><meta content="width=device-width,initial-scale=1" name=viewport><meta content=#9d4edd name=theme-color><meta content=#c77dff media=(prefers-color-scheme:dark) name=theme-color><title>Asynchronous HTTP Request - azmablog</title><link href=https://blog.azmarach.work/posts/asynchronous-http-request/ rel=canonical><link href=https://blog.azmarach.work/favicon.png rel=icon type=image/png><link href=https://blog.azmarach.work/apple-touch-icon.png rel=apple-touch-icon sizes=180x180 type=image/png><link href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext x='-.07em' y='.89em' font-size='90'%3Eü¶Ä%3C/text%3E%3C/svg%3E" rel=icon><link title="azmablog - Atom Feed" href=https://blog.azmarach.work/atom.xml rel=alternate type=application/atom+xml><style>:root{--accent-color:#9d4edd}[data-theme=dark]{--accent-color:#c77dff}@media (prefers-color-scheme:dark){:root:not([data-theme=light]){--accent-color:#c77dff}}</style><link href=https://blog.azmarach.work/style.css rel=stylesheet><link href=https://blog.azmarach.work/icons.css rel=stylesheet><link href=https://blog.azmarach.work/custom.css rel=stylesheet><script defer src=https://blog.azmarach.work/closable.js></script><script defer src=https://blog.azmarach.work/copy-button.js></script><script defer src=https://blog.azmarach.work/theme-switcher.js></script><meta content=azmablog property=og:site_name><meta content="Asynchronous HTTP Request - azmablog" property=og:title><meta content=https://blog.azmarach.work/posts/asynchronous-http-request/ property=og:url><meta content="One of my previous blog articles on basic Java" property=og:description><meta content=https://blog.azmarach.work/card.png property=og:image><meta content=en_US property=og:locale><body><header id=site-nav><nav><a href=#main-content tabindex=0> Skip to Main Content </a><ul><li><a href=https://azmarach.work>üåê ‚Üê Back to main site</a><li id=home><a href=https://blog.azmarach.work> <i class=icon></i>azmablog</a><li class=divider><li><a href=https://blog.azmarach.work/posts>Posts</a><li><a href=https://blog.azmarach.work/code>Code</a><li id=theme-switcher><details class=closable><summary class=circle title=Theme><i class=icon></i></summary> <ul><li><button title="Switch to Light Theme" class=circle id=theme-light><i class=icon></i></button><li><button title="Switch to Dark Theme" class=circle id=theme-dark><i class=icon></i></button><li><button title="Use System Theme" class=circle id=theme-system><i class=icon></i></button></ul></details></ul></nav></header><main id=main-content><article><div id=heading><p><small> <time datetime=" 2024-03-02T00:00:00+00:00">Published on March 02, 2024</time></small><h1>Asynchronous HTTP Request</h1><p><small><span>3 minutes read</span><span> ‚Ä¢ </span></small><ul class=tags><a class=tag href=https://blog.azmarach.work/tags>tags:</a><li><a class=tag href=https://blog.azmarach.work/tags/java/>java</a><li><a class=tag href=https://blog.azmarach.work/tags/archive/>archive</a><li><a class=tag href=https://blog.azmarach.work/tags/http/>http</a></ul><br></div><div id=buttons-container><details class=closable id=toc><summary title="Table of Contents"><i class=icon></i></summary> <div><strong class=title>Table of Contents</strong><div><ul><li><a href=https://blog.azmarach.work/posts/asynchronous-http-request/#asynchronous-http-request-in-java>Asynchronous HTTP Request in Java</a><ul><li><a href=https://blog.azmarach.work/posts/asynchronous-http-request/#imports>Imports</a><li><a href=https://blog.azmarach.work/posts/asynchronous-http-request/#program-arguments>Program Arguments</a><li><a href=https://blog.azmarach.work/posts/asynchronous-http-request/#creating-the-http-client>Creating the HTTP Client</a><li><a href=https://blog.azmarach.work/posts/asynchronous-http-request/#sending-multiple-get-requests>Sending Multiple GET Requests</a><li><a href=https://blog.azmarach.work/posts/asynchronous-http-request/#result>Result</a></ul></ul></div></div></details><a title="Go to Top" href=#top id=go-to-top><i class=icon></i></a></div><h2>Table of Contents</h2><ul><li><a href=https://blog.azmarach.work/posts/asynchronous-http-request/#asynchronous-http-request-in-java>Asynchronous HTTP Request in Java</a><ul><li><a href=https://blog.azmarach.work/posts/asynchronous-http-request/#imports>Imports</a><li><a href=https://blog.azmarach.work/posts/asynchronous-http-request/#program-arguments>Program Arguments</a><li><a href=https://blog.azmarach.work/posts/asynchronous-http-request/#creating-the-http-client>Creating the HTTP Client</a><li><a href=https://blog.azmarach.work/posts/asynchronous-http-request/#sending-multiple-get-requests>Sending Multiple GET Requests</a><li><a href=https://blog.azmarach.work/posts/asynchronous-http-request/#result>Result</a></ul></ul><p><del>First of all, for those who prefer video, here you go. Toward the end, there are a few extra bits I don‚Äôt mention in this article ‚Äî for example, a Java 21 preview feature and how to save the program call as an alias.</del><blockquote class=markdown-alert-note><p>I am recycling a few of my older posts from my previous blog to avoid losing them completely. However, the videos are gone; my YouTuber career didn't last long.</blockquote><hr><p>Last time, I wrote about a <a href=/posts/http-request-without-fw>Synchronous HTTP Request</a>, and today I‚Äôll try to pimp it up a bit and send multiple requests at once. The Java library is the same ‚Äî the approach is just slightly different.<p>I switch between using <em>request</em> and <em>po≈æadavek</em> (which both mean the same thing). Sorry about that ‚Äî I write whatever comes naturally to my fingers. Just take them as synonyms here.<p>With a synchronous request, the program stops and waits for a response. It‚Äôs a good idea to set a timeout for the request so you‚Äôre not waiting until Christmas. That‚Äôs why it‚Äôs called a <em>blocking</em> request.<p>With an asynchronous (non-blocking) request, the program sends it and immediately returns a <code>CompletableFuture</code> object without waiting for a response. You can then attach callbacks and define how the program should behave once the response arrives ‚Äî or doesn‚Äôt‚Ä¶<h3 id=asynchronous-http-request-in-java>Asynchronous HTTP Request in Java</h3><p>As you‚Äôll notice, I‚Äôm not handling every possible scenario here. In practice, you‚Äôd want to be more careful, but for some quick home testing, this punk version will do.<h4 id=imports>Imports</h4><p>On top of what I imported last time:<pre class=language-java data-lang=java style=color:#c0c5ce;background-color:#2b303b><code class=language-java data-lang=java><span>    </span><span style=color:#b48ead>import </span><span>java.net.</span><span style=color:#ebcb8b>URI</span><span>;
</span><span>    </span><span style=color:#b48ead>import </span><span>java.net.http.</span><span style=color:#ebcb8b>HttpClient</span><span>;
</span><span>    </span><span style=color:#b48ead>import </span><span>java.net.http.</span><span style=color:#ebcb8b>HttpRequest</span><span>;
</span><span>    </span><span style=color:#b48ead>import </span><span>java.net.http.</span><span style=color:#ebcb8b>HttpResponse</span><span>;
</span></code></pre><p>I also need to add:<pre class=language-java data-lang=java style=color:#c0c5ce;background-color:#2b303b><code class=language-java data-lang=java><span>    </span><span style=color:#b48ead>import </span><span>java.time.</span><span style=color:#ebcb8b>Duration</span><span>;                          </span><span style=color:#65737e>// because this time I set a timeout
</span><span>    </span><span style=color:#b48ead>import </span><span>java.util.</span><span style=color:#ebcb8b>ArrayList</span><span>;                         </span><span style=color:#65737e>// I collect responses into a list
</span><span>    </span><span style=color:#b48ead>import </span><span>java.util.concurrent.</span><span style=color:#ebcb8b>CompletableFuture</span><span>;      </span><span style=color:#65737e>// the object returned by async calls
</span><span>    </span><span style=color:#b48ead>import </span><span>java.util.concurrent.</span><span style=color:#ebcb8b>ExecutionException</span><span>;     </span><span style=color:#65737e>// in case something goes wrong
</span></code></pre><h4 id=program-arguments>Program Arguments</h4><p>I wanted the option to decide how many requests to send when running the program. That‚Äôs easy enough to do by passing an argument, like <code>java &lt;filename> &lt;arg></code>. So, right at the start, I make sure the user actually provided one. If not, the program exits and explains how to use it.<pre class=language-java data-lang=java style=color:#c0c5ce;background-color:#2b303b><code class=language-java data-lang=java><span>    </span><span style=color:#b48ead>if </span><span>(args.length &lt; </span><span style=color:#d08770>1</span><span>) {
</span><span>        </span><span style=color:#ebcb8b>System</span><span>.out.</span><span style=color:#bf616a>println</span><span>("</span><span style=color:#a3be8c>Please, add desired amount of requests.</span><span>");
</span><span>        </span><span style=color:#ebcb8b>System</span><span>.out.</span><span style=color:#bf616a>println</span><span>("</span><span style=color:#a3be8c>Usage: java &lt;file name> &lt;number></span><span>");
</span><span>        </span><span style=color:#b48ead>return</span><span>;
</span><span>    }
</span></code></pre><h4 id=creating-the-http-client>Creating the HTTP Client</h4><p>This part is the same as with the synchronous request, except for the new timeout setting.<pre class=language-java data-lang=java style=color:#c0c5ce;background-color:#2b303b><code class=language-java data-lang=java><span>    </span><span style=color:#ebcb8b>HttpClient</span><span> client = </span><span style=color:#ebcb8b>HttpClient</span><span>.</span><span style=color:#bf616a>newHttpClient</span><span>();
</span><span>
</span><span>    </span><span style=color:#ebcb8b>HttpRequest</span><span> request = </span><span style=color:#ebcb8b>HttpRequest</span><span>.</span><span style=color:#bf616a>newBuilder</span><span>()
</span><span>            .</span><span style=color:#bf616a>uri</span><span>(</span><span style=color:#ebcb8b>URI</span><span>.</span><span style=color:#bf616a>create</span><span>("</span><span style=color:#a3be8c>https://www.boredapi.com/api/activity</span><span>"))
</span><span>            .</span><span style=color:#bf616a>timeout</span><span>(</span><span style=color:#ebcb8b>Duration</span><span>.</span><span style=color:#bf616a>ofMinutes</span><span>(</span><span style=color:#d08770>1</span><span>))
</span><span>            .</span><span style=color:#bf616a>GET</span><span>()
</span><span>            .</span><span style=color:#bf616a>build</span><span>();
</span></code></pre><h4 id=sending-multiple-get-requests>Sending Multiple GET Requests</h4><p>As I mentioned above, an asynchronous request returns a <code>CompletableFuture</code> object. The <code>for</code> loop handles the number of iterations, which I‚Äôll specify when running the program.<pre class=language-java data-lang=java style=color:#c0c5ce;background-color:#2b303b><code class=language-java data-lang=java><span>    </span><span style=color:#ebcb8b>ArrayList</span><span>&lt;</span><span style=color:#ebcb8b>String</span><span>> results = </span><span style=color:#b48ead>new </span><span style=color:#ebcb8b>ArrayList</span><span>&lt;>();      </span><span style=color:#65737e>// where I‚Äôll store the response bodies
</span><span>    </span><span style=color:#b48ead>int</span><span> numberOfRequests = </span><span style=color:#ebcb8b>Integer</span><span>.</span><span style=color:#bf616a>parseInt</span><span>(args[</span><span style=color:#d08770>0</span><span>]);   </span><span style=color:#65737e>// could use some validation here
</span><span>
</span><span>    </span><span style=color:#65737e>// Generics and arrays trigger a compiler warning: [unchecked] unchecked conversion
</span><span>    </span><span style=color:#ebcb8b>CompletableFuture</span><span>&lt;</span><span style=color:#ebcb8b>Void</span><span>></span><span style=color:#b48ead>[]</span><span> responseFutures = </span><span style=color:#b48ead>new </span><span style=color:#ebcb8b>CompletableFuture</span><span>[numberOfRequests];
</span><span>
</span><span>    </span><span style=color:#b48ead>for </span><span>(</span><span style=color:#b48ead>int</span><span> i = </span><span style=color:#d08770>0</span><span>; i &lt; numberOfRequests; i++) {
</span><span>        responseFutures[i] = client.</span><span style=color:#bf616a>sendAsync</span><span>(request, </span><span style=color:#ebcb8b>HttpResponse</span><span>.</span><span style=color:#ebcb8b>BodyHandlers</span><span>.</span><span style=color:#bf616a>ofString</span><span>())
</span><span>                    .</span><span style=color:#bf616a>thenApply</span><span>(</span><span style=color:#ebcb8b>HttpResponse</span><span>::</span><span style=color:#bf616a>body</span><span>)
</span><span>                    .</span><span style=color:#bf616a>thenAccept</span><span>(</span><span style=color:#bf616a>responseBody </span><span style=color:#b48ead>-> </span><span>{
</span><span>                        results.</span><span style=color:#bf616a>add</span><span>(responseBody);
</span><span>                    })
</span><span>                    .</span><span style=color:#bf616a>exceptionally</span><span>(</span><span style=color:#bf616a>e </span><span style=color:#b48ead>-> </span><span>{
</span><span>                        e.</span><span style=color:#bf616a>printStackTrace</span><span>();
</span><span>                        </span><span style=color:#b48ead>return </span><span style=color:#d08770>null</span><span>;    </span><span style=color:#65737e>// if the above function throws, it‚Äôs caught here and the CompletableFuture becomes null
</span><span>                    });
</span><span>
</span><span>        </span><span style=color:#ebcb8b>System</span><span>.out.</span><span style=color:#bf616a>println</span><span>("</span><span style=color:#a3be8c>The </span><span>" + (i + </span><span style=color:#d08770>1</span><span>) + "</span><span style=color:#a3be8c>. request has been sent.</span><span>");
</span><span>    }
</span></code></pre><p>Then I just wait for all responses to finish before the program exits, and print out the strings I stored.<pre class=language-java data-lang=java style=color:#c0c5ce;background-color:#2b303b><code class=language-java data-lang=java><span>    </span><span style=color:#ebcb8b>CompletableFuture</span><span>.</span><span style=color:#bf616a>allOf</span><span>(responseFutures).</span><span style=color:#bf616a>join</span><span>();
</span><span>
</span><span>    </span><span style=color:#ebcb8b>System</span><span>.out.</span><span style=color:#bf616a>println</span><span>("</span><span style=color:#96b5b4>\n</span><span style=color:#a3be8c>Here are the results:</span><span>");
</span><span>
</span><span>    </span><span style=color:#b48ead>for </span><span>(</span><span style=color:#ebcb8b>String</span><span> s : results) {
</span><span>        </span><span style=color:#ebcb8b>System</span><span>.out.</span><span style=color:#bf616a>println</span><span>(s);
</span><span>    }
</span></code></pre><h4 id=result>Result</h4><p>It works! Here‚Äôs the output when I forget to specify the number of iterations:<pre class=language-bash data-lang=bash style=color:#c0c5ce;background-color:#2b303b><code class=language-bash data-lang=bash><span>    > java </span><span style=color:#bf616a>AsyncApiCall 
</span><span>    </span><span style=color:#bf616a>Please,</span><span> add desired amount of requests.
</span><span>    </span><span style=color:#bf616a>Usage:</span><span> java &lt;file name> &lt;number>
</span></code></pre><p>And here‚Äôs what it looks like with three requests:<pre class=language-java data-lang=java style=color:#c0c5ce;background-color:#2b303b><code class=language-java data-lang=java><span>    > java </span><span style=color:#ebcb8b>AsyncApiCall </span><span style=color:#d08770>3
</span><span>    </span><span style=color:#ebcb8b>The </span><span style=color:#d08770>1.</span><span> request has been sent.
</span><span>    </span><span style=color:#ebcb8b>The </span><span style=color:#d08770>2.</span><span> request has been sent.
</span><span>    </span><span style=color:#ebcb8b>The </span><span style=color:#d08770>3.</span><span> request has been sent.
</span><span>
</span><span>    </span><span style=color:#ebcb8b>Here</span><span> are the results:
</span><span>    {"</span><span style=color:#a3be8c>activity</span><span>":"</span><span style=color:#a3be8c>Learn how to fold a paper crane</span><span>","</span><span style=color:#a3be8c>type</span><span>":"</span><span style=color:#a3be8c>education</span><span>","</span><span style=color:#a3be8c>participants</span><span>":</span><span style=color:#d08770>1</span><span>,"</span><span style=color:#a3be8c>price</span><span>":</span><span style=color:#d08770>0.1</span><span>,"</span><span style=color:#a3be8c>link</span><span>":"","</span><span style=color:#a3be8c>key</span><span>":"</span><span style=color:#a3be8c>3136036</span><span>","</span><span style=color:#a3be8c>accessibility</span><span>":</span><span style=color:#d08770>0.05</span><span>}
</span><span>    {"</span><span style=color:#a3be8c>activity</span><span>":"</span><span style=color:#a3be8c>Go see a Broadway production</span><span>","</span><span style=color:#a3be8c>type</span><span>":"</span><span style=color:#a3be8c>recreational</span><span>","</span><span style=color:#a3be8c>participants</span><span>":</span><span style=color:#d08770>4</span><span>,"</span><span style=color:#a3be8c>price</span><span>":</span><span style=color:#d08770>0.8</span><span>,"</span><span style=color:#a3be8c>link</span><span>":"","</span><span style=color:#a3be8c>key</span><span>":"</span><span style=color:#a3be8c>4448913</span><span>","</span><span style=color:#a3be8c>accessibility</span><span>":</span><span style=color:#d08770>0.3</span><span>}
</span><span>    {"</span><span style=color:#a3be8c>activity</span><span>":"</span><span style=color:#a3be8c>Watch a movie you'd never usually watch</span><span>","</span><span style=color:#a3be8c>type</span><span>":"</span><span style=color:#a3be8c>relaxation</span><span>","</span><span style=color:#a3be8c>participants</span><span>":</span><span style=color:#d08770>1</span><span>,"</span><span style=color:#a3be8c>price</span><span>":</span><span style=color:#d08770>0.15</span><span>,"</span><span style=color:#a3be8c>link</span><span>":"","</span><span style=color:#a3be8c>key</span><span>":"</span><span style=color:#a3be8c>9212950</span><span>","</span><span style=color:#a3be8c>accessibility</span><span>":</span><span style=color:#d08770>0.15</span><span>}
</span></code></pre><p>This time I didn‚Äôt bother extracting just the <code>activity</code> field, so you can see the full response body here. If you‚Äôre curious how to grab only the activity using regex, check out the <a href=../http-request-bez-fw>post about the synchronous request</a>.<p>See you next time!</article><hr><nav id=post-nav><a class="post-nav-item post-nav-prev" href=https://blog.azmarach.work/posts/http-request-without-fw/> <div class=nav-arrow>Previous</div> <span class=post-title>HTTP Request Without FW</span> </a><a class="post-nav-item post-nav-next" href=https://blog.azmarach.work/posts/program-branching/> <div class=nav-arrow>Next</div> <span class=post-title>Program Branching</span> </a></nav></main><footer id=site-footer><p>¬© azmablog, 2025<p><small>Powered by <a class="link external" rel="noopener nofollow noreferrer" href=https://www.getzola.org>Zola</a> and <a class="link external" rel="noopener nofollow noreferrer" href=https://duckquill.daudix.one>Duckquill</a> </small></footer><span class=hidden id=copy-code-text>Copy Code</span><style>:root{--alert-note-text:"Note";--alert-tip-text:"Tip";--alert-important-text:"Important";--alert-warning-text:"Warning";--alert-caution-text:"Caution"}</style>